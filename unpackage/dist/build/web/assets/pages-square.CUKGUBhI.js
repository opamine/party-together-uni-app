import{g as t,u as e,c as i,r as s,o as r,a,w as n,b as o,n as l,d as h,e as c,F as u,f as d,h as f,t as g,i as b,j as p,k as m,S as y,l as w,m as S,p as x,q as C}from"./index-CU53kGQk.js";import{_ as I,a as v,d as T}from"./dynamicList.CUIBB9Ky.js";import{r as _}from"./uni-app.es.CQ6hYvRK.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DhGjUbg6.js";import"./uni-dateformat.Dut3rE6F.js";let L=p;const{windowWidth:W}=t();const A=B({name:"u-tabs-swiper",emits:["update:modelValue","input","change"],props:{isScroll:{type:Boolean,default:!0},list:{type:Array,default:()=>[]},current:{type:[Number,String],default:0},height:{type:[Number,String],default:80},fontSize:{type:[Number,String],default:30},swiperWidth:{type:[String,Number],default:750},activeColor:{type:String,default:"#2979ff"},inactiveColor:{type:String,default:"#303133"},barWidth:{type:[Number,String],default:40},barHeight:{type:[Number,String],default:6},gutter:{type:[Number,String],default:40},zIndex:{type:[Number,String],default:1},bgColor:{type:String,default:"#ffffff"},autoCenterMode:{type:String,default:"window"},name:{type:String,default:"name"},count:{type:String,default:"count"},offset:{type:Array,default:()=>[5,20]},bold:{type:Boolean,default:!0},activeItemStyle:{type:Object,default:()=>({})},showBar:{type:Boolean,default:!0},barStyle:{type:Object,default:()=>({})}},data(){return{scrollLeft:0,tabQueryInfo:[],windowWidth:0,animationFinishCurrent:this.current,componentsWidth:0,line3AddDx:0,line3Dx:0,preId:"UEl_",sW:0,tabsInfo:[],colorGradientArr:[],colorStep:100}},computed:{getCurrent(){const t=Number(this.current);return t>this.getTabs.length-1?this.getTabs.length-1:t<0?0:t},getTabs(){return this.list},scrollBarLeft(){return Number(this.line3Dx)+Number(this.line3AddDx)},barWidthPx(){return e(this.barWidth)},tabItemStyle(){return t=>{let e={height:this.height+"rpx",lineHeight:this.height+"rpx",padding:`0 ${this.gutter/2}rpx`,color:this.tabsInfo.length>0?this.tabsInfo[t]?this.tabsInfo[t].color:this.activeColor:this.inactiveColor,fontSize:this.fontSize+"rpx",zIndex:this.zIndex+2,fontWeight:t==this.getCurrent&&this.bold?"bold":"normal"};return t==this.getCurrent&&(e=Object.assign(e,this.activeItemStyle)),e}},tabBarStyle(){let t={width:this.barWidthPx+"px",height:this.barHeight+"rpx",borderRadius:"100px",backgroundColor:this.activeColor,left:this.scrollBarLeft+"px"};return Object.assign(t,this.barStyle)}},watch:{current(t,e){this.change(t),this.setFinishCurrent(t)},list(){this.$nextTick((()=>{this.init()}))}},mounted(){this.init()},methods:{async init(){this.countPx(),await this.getTabsInfo(),this.countLine3Dx(),this.getQuery((()=>{this.setScrollViewToCenter()})),this.colorGradientArr=L.colorGradient(this.inactiveColor,this.activeColor,this.colorStep)},getTabsInfo(){return new Promise(((t,e)=>{let s=i().in(this);for(let i=0;i<this.list.length;i++)s.select(".UEl_"+i).boundingClientRect();s.exec((e=>{const i=[];for(let t=0;t<e.length;t++)e[t].color=this.inactiveColor,t==this.getCurrent&&(e[t].color=this.activeColor),i.push(e[t]);this.tabsInfo=i,t()}))}))},countLine3Dx(){const t=this.tabsInfo[this.animationFinishCurrent];t&&(this.line3Dx=t.left+t.width/2-this.barWidthPx/2-this.tabsInfo[0].left)},countPx(){this.sW=e(Number(this.swiperWidth))},emit(t){this.$emit("change",t)},change(){this.setScrollViewToCenter()},getQuery(t){try{i().in(this).select(".u-tabs").fields({size:!0},(e=>{e?(this.componentsWidth=e.width,t&&"function"==typeof t&&t(e)):this.getQuery(t)})).exec()}catch(e){this.componentsWidth=W}},setScrollViewToCenter(){let t;if(t=this.tabsInfo[this.animationFinishCurrent],t){let e,i=t.left+t.width/2;e="window"===this.autoCenterMode?W:this.componentsWidth,this.scrollLeft=i-e/2}},setDx(t){let e=t>0?this.animationFinishCurrent+1:this.animationFinishCurrent-1;e=e<=0?0:e,e=e>=this.list.length?this.list.length-1:e,this.tabsInfo[e];let i=this.tabsInfo[this.animationFinishCurrent],s=i.left+i.width/2,r=this.tabsInfo[e],a=r.left+r.width/2,n=Math.abs(a-s);this.line3AddDx=t/this.sW*n,this.setTabColor(this.animationFinishCurrent,e,t)},setTabColor(t,e,i){let s=Math.abs(Math.ceil(i/this.sW*100)),r=this.colorGradientArr.length;s=s>=r?r-1:s<=0?0:s,this.tabsInfo[e].color=this.colorGradientArr[s],this.tabsInfo[t].color=this.colorGradientArr[r-1-s]},setFinishCurrent(t){this.tabsInfo.map(((e,i)=>(e.color=t==i?this.activeColor:this.inactiveColor,e))),this.line3AddDx=0,this.animationFinishCurrent=t,this.countLine3Dx()}}},[["render",function(t,e,i,p,w,S){const x=_(s("u-badge"),I),C=m,v=y;return r(),a(C,{class:"u-tabs",style:l({zIndex:i.zIndex,background:i.bgColor})},{default:n((()=>[o(v,{"scroll-x":"",class:"u-scroll-view","scroll-left":w.scrollLeft,"scroll-with-animation":"",style:l({zIndex:i.zIndex+1})},{default:n((()=>[o(C,{class:h(["u-tabs-scroll-box",{"u-tabs-scroll-flex":!i.isScroll}])},{default:n((()=>[(r(!0),c(u,null,d(S.getTabs,((t,e)=>(r(),a(C,{class:h(["u-tabs-item",[w.preId+e]]),style:l([S.tabItemStyle(e)]),key:e,onClick:t=>S.emit(e)},{default:n((()=>[o(x,{count:t[i.count]||t.count||0,offset:i.offset,size:"mini"},null,8,["count","offset"]),f(" "+g(t[i.name]||t.name),1)])),_:2},1032,["style","class","onClick"])))),128)),i.showBar?(r(),a(C,{key:0,class:"u-scroll-bar",style:l([S.tabBarStyle])},null,8,["style"])):b("",!0)])),_:1},8,["class"])])),_:1},8,["scroll-left","style"])])),_:1},8,["style"])}],["__scopeId","data-v-9cfc860e"]]);const D=B({components:{activityList:v,dynamicList:T},data:()=>({statusBarHeight:0,rightSafeArea:0,windowHeight:0,currentSwiper:0,currentTab:0,tabs:[{name:"活动"},{name:"推荐"},{name:"关注"}]}),computed:{headerHeight(){return e(80)+this.statusBarHeight}},onLoad(){const e=S(),{statusBarHeight:i,rightSafeArea:s}=e.globalData;this.statusBarHeight=i,this.rightSafeArea=s,this.windowHeight=t().windowHeight},methods:{changeTab(t){this.currentSwiper=t},transition(t){let e=t.detail.dx;this.$refs.tabs.setDx(e)},animationfinish(t){const e=t.detail.current;this.$refs.tabs.setFinishCurrent(e),this.currentSwiper=e,this.currentTab=e},onreachBottom(){switch(console.log("onreachBottom"),this.currentTab){case 0:this.$refs.activityList.getData();break;case 1:this.$refs.activityList1.getData();break;case 2:this.$refs.dynamicList.getData()}}}},[["render",function(t,e,i,a,h,d){const f=_(s("u-tabs-swiper"),A),g=m,b=w("activity-list"),p=y,S=x,I=w("dynamic-list"),v=C;return r(),c(u,null,[o(g,{class:"square-header",style:l({paddingTop:h.statusBarHeight+"px",paddingRight:h.rightSafeArea+"px"})},{default:n((()=>[o(f,{ref:"tabs",list:h.tabs,"is-scroll":!1,modelValue:h.currentTab,"onUpdate:modelValue":e[0]||(e[0]=t=>h.currentTab=t),onChange:d.changeTab,"active-color":"#000","inactive-color":"#989898",bold:!1,height:80},null,8,["list","modelValue","onChange"])])),_:1},8,["style"]),o(g,{class:"square-content",style:l({paddingTop:d.headerHeight+"px"})},{default:n((()=>[o(v,{current:h.currentSwiper,onTransition:d.transition,onAnimationfinish:d.animationfinish,style:l({height:h.windowHeight-d.headerHeight+"px"})},{default:n((()=>[o(S,{class:"swiper-item"},{default:n((()=>[o(p,{"scroll-y":"",style:{height:"100%"},onScrolltolower:d.onreachBottom},{default:n((()=>[o(b,{ref:"activityList",mode:"participate"},null,512)])),_:1},8,["onScrolltolower"])])),_:1}),o(S,{class:"swiper-item"},{default:n((()=>[o(p,{"scroll-y":"",style:{height:"100%"},onScrolltolower:d.onreachBottom},{default:n((()=>[o(b,{ref:"activityList1",mode:"participate"},null,512)])),_:1},8,["onScrolltolower"])])),_:1}),o(S,{class:"swiper-item"},{default:n((()=>[o(p,{"scroll-y":"",style:{height:"100%"},onScrolltolower:d.onreachBottom},{default:n((()=>[o(I,{ref:"dynamicList"},null,512)])),_:1},8,["onScrolltolower"])])),_:1})])),_:1},8,["current","onTransition","onAnimationfinish","style"])])),_:1},8,["style"])],64)}],["__scopeId","data-v-ee6bb91c"]]);export{D as default};
