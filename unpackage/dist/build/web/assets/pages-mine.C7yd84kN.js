import{c as t,u as e,r as i,o as s,a,w as n,b as l,d as r,e as o,F as c,f as u,n as h,h as d,t as f,i as g,k as b,S as p,z as m,y,g as x,A as v,B as _,C as H,l as I,m as T,D as k,E as S,x as C,s as w}from"./index-CU53kGQk.js";import{_ as B}from"./uni-icons.DhGjUbg6.js";import{r as $}from"./uni-app.es.CQ6hYvRK.js";import{_ as O,w as L,p as z,d as N,a as R}from"./dynamicList.CUIBB9Ky.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-dateformat.Dut3rE6F.js";const j=F({name:"u-tabs",emits:["update:modelValue","input","change"],props:{value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},current:{type:[Number,String],default:0},isScroll:{type:Boolean,default:!0},list:{type:Array,default:()=>[]},height:{type:[String,Number],default:80},fontSize:{type:[String,Number],default:30},duration:{type:[String,Number],default:.5},activeColor:{type:String,default:"#2979ff"},inactiveColor:{type:String,default:"#303133"},barWidth:{type:[String,Number],default:40},barHeight:{type:[String,Number],default:6},gutter:{type:[String,Number],default:30},bgColor:{type:String,default:"#ffffff"},name:{type:String,default:"name"},count:{type:String,default:"count"},offset:{type:Array,default:()=>[5,20]},bold:{type:Boolean,default:!0},activeItemStyle:{type:Object,default:()=>({})},showBar:{type:Boolean,default:!0},barStyle:{type:Object,default:()=>({})},itemWidth:{type:[Number,String],default:"auto"}},data(){return{scrollLeft:0,tabQueryInfo:[],componentWidth:0,scrollBarLeft:0,parentLeft:0,id:this.$u.guid(),currentIndex:this.current,barFirstTimeMove:!0}},watch:{list(t,e){t.length!==e.length&&(this.currentIndex=0),this.$nextTick((()=>{this.init()}))},current:{immediate:!0,handler(t,e){this.$nextTick((()=>{this.currentIndex=t,this.scrollByIndex()}))}},valueCom:{immediate:!0,handler(t,e){this.$nextTick((()=>{this.currentIndex=t,this.scrollByIndex()}))}}},computed:{valueCom(){return this.modelValue},tabBarStyle(){let t={width:this.barWidth+"rpx",transform:`translate(${this.scrollBarLeft}px, -100%)`,"transition-duration":`${this.barFirstTimeMove?0:this.duration}s`,"background-color":this.activeColor,height:this.barHeight+"rpx","border-radius":this.barHeight/2+"px"};return Object.assign(t,this.barStyle),t},tabItemStyle(){return t=>{let e={height:this.height+"rpx","line-height":this.height+"rpx","font-size":this.fontSize+"rpx","transition-duration":`${this.duration}s`,padding:this.isScroll?`0 ${this.gutter}rpx`:"",flex:this.isScroll?"auto":"1",width:this.$u.addUnit(this.itemWidth)};return t==this.currentIndex&&this.bold&&(e.fontWeight="bold"),t==this.currentIndex?(e.color=this.activeColor,e=Object.assign(e,this.activeItemStyle)):e.color=this.inactiveColor,e}}},methods:{async init(){let t=await this.$uGetRect("#"+this.id);this.parentLeft=t.left,this.componentWidth=t.width,this.getTabRect()},clickTab(t){t!=this.currentIndex&&(this.$emit("change",t),this.$emit("input",t),this.$emit("update:modelValue",t))},getTabRect(){let e=t().in(this);for(let t=0;t<this.list.length;t++)e.select(`#u-tab-item-${t}`).fields({size:!0,rect:!0});e.exec(function(t){this.tabQueryInfo=t,this.scrollByIndex()}.bind(this))},scrollByIndex(){let t=this.tabQueryInfo[this.currentIndex];if(!t)return;let i=t.width,s=t.left-this.parentLeft-(this.componentWidth-i)/2;this.scrollLeft=s<0?0:s;let a=t.left+t.width/2-this.parentLeft;this.scrollBarLeft=a-e(this.barWidth)/2,1==this.barFirstTimeMove&&setTimeout((()=>{this.barFirstTimeMove=!1}),100)}},mounted(){this.init()}},[["render",function(t,e,m,y,x,v){const _=$(i("u-badge"),O),H=b,I=p;return s(),a(H,{class:"u-tabs",style:h({background:m.bgColor})},{default:n((()=>[l(H,{id:x.id},{default:n((()=>[l(I,{"scroll-x":"",class:"u-scroll-view","scroll-left":x.scrollLeft,"scroll-with-animation":""},{default:n((()=>[l(H,{class:r(["u-scroll-box",{"u-tabs-scroll-flex":!m.isScroll}]),id:x.id},{default:n((()=>[(s(!0),o(c,null,u(m.list,((t,e)=>(s(),a(H,{class:"u-tab-item u-line-1",id:"u-tab-item-"+e,key:e,onClick:t=>v.clickTab(e),style:h([v.tabItemStyle(e)])},{default:n((()=>[l(_,{count:t[m.count]||t.count||0,offset:m.offset,size:"mini"},null,8,["count","offset"]),d(" "+f(t[m.name]||t.name),1)])),_:2},1032,["id","onClick","style"])))),128)),m.showBar?(s(),a(H,{key:0,class:"u-tab-bar",style:h([v.tabBarStyle])},null,8,["style"])):g("",!0)])),_:1},8,["id","class"])])),_:1},8,["scroll-left"])])),_:1},8,["id"])])),_:1},8,["style"])}],["__scopeId","data-v-1621c930"]]);const W=F({name:"u-sticky",emits:["fixed","unfixed"],props:{offsetTop:{type:[Number,String],default:0},index:{type:[Number,String],default:""},enable:{type:Boolean,default:!0},h5NavHeight:{type:[Number,String],default:44},bgColor:{type:String,default:"#ffffff"},zIndex:{type:[Number,String],default:""}},data(){return{fixed:!1,height:"auto",stickyTop:0,elClass:this.$u.guid(),left:0,width:"auto"}},watch:{offsetTop(t){this.initObserver()},enable(t){0==t?(this.fixed=!1,this.disconnectObserver("contentObserver")):this.initObserver()}},computed:{uZIndex(){return this.zIndex?this.zIndex:this.$u.zIndex.sticky}},mounted(){this.initObserver()},methods:{initObserver(){this.enable&&(this.stickyTop=0!=this.offsetTop?e(this.offsetTop)+this.h5NavHeight:this.h5NavHeight,this.disconnectObserver("contentObserver"),this.$uGetRect("."+this.elClass).then((t=>{this.height=t.height,this.left=t.left,this.width=t.width,this.$nextTick((()=>{this.observeContent()}))})))},observeContent(){this.disconnectObserver("contentObserver");const t=m(this,{thresholds:[.95,.98,1]});t.relativeToViewport({top:-this.stickyTop}),t.observe("."+this.elClass,(t=>{this.enable&&this.setFixed(t.boundingClientRect.top)})),this.contentObserver=t},setFixed(t){const e=t<this.stickyTop;e?this.$emit("fixed",this.index):this.fixed&&this.$emit("unfixed",this.index),this.fixed=e},disconnectObserver(t){const e=this[t];e&&e.disconnect()}},beforeUnmount(){this.disconnectObserver("contentObserver")}},[["render",function(t,e,i,o,c,u){const d=b;return s(),a(d,{class:""},{default:n((()=>[l(d,{class:r(["u-sticky-wrap",[c.elClass]]),style:h({height:c.fixed?c.height+"px":"auto",backgroundColor:i.bgColor})},{default:n((()=>[l(d,{class:"u-sticky",style:h({position:c.fixed?"fixed":"static",top:c.stickyTop+"px",left:c.left+"px",width:"auto"==c.width?"auto":c.width+"px",zIndex:u.uZIndex})},{default:n((()=>[y(t.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3},8,["class","style"])])),_:3})}],["__scopeId","data-v-ecb5b5db"]]),V=["age","region","mbti"];const D=F({components:{waterFall:L,participatorList:z,dynamicList:N,activityList:R},data:()=>({screenHeight:0,navHeight:0,statusBarHeight:0,navigationBarHeight:0,mineHeaderOpacity:0,mineContentHeight:0,scrollTop:0,userInfo:{},InfoTagsFields:V,currentTab:0,tabs:[{name:"动态"},{name:"活动参与"},{name:"我的发布"}],tabsHeight:e(90)}),computed:{navHeightOfRpx(){return this.navHeight/(e(100)/100)}},onLoad(){console.log("onLoad");const t=T(),{statusBarHeight:e,navigationBarHeight:i,navHeight:s}=t.globalData;this.screenHeight=x().windowHeight,this.statusBarHeight=e,this.navigationBarHeight=i,this.navHeight=s},onShow(){const t=T();this.userInfo={...t.globalData.userInfo}},onPageScroll(t){this.scrollTop=t.scrollTop,t.scrollTop<=e(150)?this.mineHeaderOpacity=t.scrollTop/e(150):this.mineHeaderOpacity=1},onPullDownRefresh(){setTimeout((()=>{v()}),1e3)},onReachBottom(){switch(console.log("reachBottom"),this.currentTab){case 0:this.$refs.dynamicList.getData();break;case 1:this.$refs.activityList.getData();break;case 2:this.$refs.publishList.getData()}},onReady(){t().select(".mine-content").boundingClientRect((t=>{this.mineContentHeight=t.height})).exec()},methods:{changeTab(){this.scrollTop>=this.mineContentHeight-this.navHeight&&_({scrollTop:this.mineContentHeight-this.navHeight,duration:0})},handleEditPersonal(){H({url:"/pages/personal/edit"})},handlePublish(){console.log(this.currentTab),0===this.currentTab&&H({url:"/pages/dynamic/dynamicRelease"}),2===this.currentTab&&H({url:"/pages/activity/activityRelease"})}}},[["render",function(t,e,r,p,m,y){const x=b,v=C,_=w,H=$(i("uni-icons"),B),T=$(i("u-tabs"),j),O=$(i("u-sticky"),W),L=I("dynamic-list"),z=I("activity-list");return s(),o(c,null,[m.navHeight?(s(),a(x,{key:0,class:"mine-header",style:h({height:m.navHeight+"px",paddingTop:m.statusBarHeight+"px",boxSizing:"border-box",opacity:m.mineHeaderOpacity})},{default:n((()=>[d(f(m.userInfo.nickName),1)])),_:1},8,["style"])):g("",!0),l(x,{class:"mine-container"},{default:n((()=>[l(x,{class:"mine-content",style:h({paddingTop:m.navHeight+"px",backgroundImage:`linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 1)),\n        url(${m.userInfo.backgroundImage})`,backgroundSize:"100% auto"})},{default:n((()=>[l(x,{class:"mine-info"},{default:n((()=>[l(x,{class:"avatar-container"},{default:n((()=>[l(v,{class:"avatar",src:m.userInfo.avatar,mode:"aspectFill"},null,8,["src"])])),_:1}),l(x,{class:"describle-container"},{default:n((()=>[l(x,{class:"nickName"},{default:n((()=>[l(_,null,{default:n((()=>[d(f(m.userInfo.nickName),1)])),_:1})])),_:1}),l(x,{class:"account"},{default:n((()=>[d("派对账号："+f(m.userInfo.account),1)])),_:1})])),_:1})])),_:1}),l(x,{class:"mine-signature"},{default:n((()=>[d(f(m.userInfo.signature||"这个人还没有个性签名"),1)])),_:1}),l(x,{class:"mine-info-tags"},{default:n((()=>[l(x,{class:"info-tags-container"},{default:n((()=>[(s(!0),o(c,null,u(m.InfoTagsFields,(t=>(s(),a(x,{key:t,class:"info-tag"},{default:n((()=>["age"===t?(s(),a(H,{key:0,"custom-prefix":"iconfont",type:"icon-40nan-1",size:"24rpx",color:"#7fc1fe",style:{"margin-right":"4px"}})):g("",!0),"region"===t?(s(),a(_,{key:1},{default:n((()=>{var e,i;return[d(f((null==(e=m.userInfo[t])?void 0:e[0])??""+(null==(i=m.userInfo[t])?void 0:i[1])??""),1)]})),_:2},1024)):(s(),a(_,{key:2},{default:n((()=>[d(f(m.userInfo[t]),1)])),_:2},1024)),"age"===t&&m.userInfo[t]?(s(),a(_,{key:3},{default:n((()=>[d("岁")])),_:1})):g("",!0)])),_:2},1024)))),128)),m.userInfo.career&&m.userInfo.career.length?(s(!0),o(c,{key:0},u(m.userInfo.career,(t=>(s(),a(x,{key:t,class:"info-tag"},{default:n((()=>[l(_,null,{default:n((()=>[d(f(t.split("-")[1]),1)])),_:2},1024)])),_:2},1024)))),128)):g("",!0)])),_:1})])),_:1}),l(x,{class:"mine-socializing"},{default:n((()=>[l(x,{class:"left"},{default:n((()=>[l(x,{class:"left-item"},{default:n((()=>[l(x,{class:"count"},{default:n((()=>[d("20")])),_:1}),l(x,{class:"cate"},{default:n((()=>[d("关注")])),_:1})])),_:1}),l(x,{class:"left-item"},{default:n((()=>[l(x,{class:"count"},{default:n((()=>[d("30")])),_:1}),l(x,{class:"cate"},{default:n((()=>[d("粉丝")])),_:1})])),_:1}),l(x,{class:"left-item"},{default:n((()=>[l(x,{class:"count"},{default:n((()=>[d("99")])),_:1}),l(x,{class:"cate"},{default:n((()=>[d("活动次数")])),_:1})])),_:1}),l(x,{class:"left-item"},{default:n((()=>[l(x,{class:"count"},{default:n((()=>[d("99")])),_:1}),l(x,{class:"cate"},{default:n((()=>[d("动态获赞")])),_:1})])),_:1})])),_:1}),l(x,{class:"right"},{default:n((()=>[l(x,{class:"right-btn",onClick:y.handleEditPersonal},{default:n((()=>[d("编辑资料")])),_:1},8,["onClick"]),l(x,{class:"right-btn"},{default:n((()=>[l(H,{type:"gear",size:"30rpx",color:"#fff"})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),l(O,{"offset-top":y.navHeightOfRpx,"h5-nav-height":m.navHeight},{default:n((()=>[l(x,{class:"mine-social-activity-tabs"},{default:n((()=>[l(T,{list:m.tabs,"is-scroll":!1,modelValue:m.currentTab,"onUpdate:modelValue":e[0]||(e[0]=t=>m.currentTab=t),onChange:y.changeTab,"active-color":"#272a30","inactive-color":"#989898",bold:!1,height:90},null,8,["list","modelValue","onChange"])])),_:1})])),_:1},8,["offset-top","h5-nav-height"]),k(l(x,{style:h({boxSizing:"border-box",minHeight:m.screenHeight-m.navHeight-m.tabsHeight+"px"})},{default:n((()=>[l(L,{ref:"dynamicList"},null,512)])),_:1},8,["style"]),[[S,0===m.currentTab]]),k(l(x,{style:h({boxSizing:"border-box",minHeight:m.screenHeight-m.navHeight-m.tabsHeight+"px"})},{default:n((()=>[l(z,{ref:"activityList",mode:"participate"},null,512)])),_:1},8,["style"]),[[S,1===m.currentTab]]),k(l(x,{style:h({boxSizing:"border-box",minHeight:m.screenHeight-m.navHeight-m.tabsHeight+"px"})},{default:n((()=>[l(z,{ref:"publishList",mode:"publish"},null,512)])),_:1},8,["style"]),[[S,2===m.currentTab]]),k(l(x,{onClick:y.handlePublish,class:"publish-button"},{default:n((()=>[l(H,{type:"plusempty",size:"40rpx",color:"#fff"})])),_:1},8,["onClick"]),[[S,0===m.currentTab||2===m.currentTab]])])),_:1})],64)}],["__scopeId","data-v-e1f9c584"]]);export{D as default};
